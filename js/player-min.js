const ID3=window.jsmediatags,sin=Math.sin,π=Math.PI;var urlParameter=!1;function ease(e){return sin(e*π/2)}function draw(e){var n=new Image;return n.src=e,n.onload=function(){},n}function replaceurl(e){var n=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+e;window.history.pushState({path:n},"",n)}function animate(e,n,t,a){var i=(new Date).getTime()-a,o=n.height/2-e.height/2,l=150*sin(2*i*π/5e3)+o;e.Y=l,t.clearRect(0,0,n.width,n.height),t.drawImage(e)}function getRMS(e){for(var n,t=0,a=e.length,i=0;i<a;i++)t+=Math.pow(e[i],2);return n=t/a,Math.sqrt(n)}function calcRMSColor(e){return 150*(e/100)}window.addEventListener("load",function(){var e=document.getElementById("thefile"),n=document.getElementById("file-label");document.getElementById("media-container").innerHTML='\n    <canvas id="canvas"></canvas>\n    <div id="main">\n        <div id="album">\n            <div id="MediaPlayerControls">\n                <div id="MediaPlayerIcon-icon-play" class="MediaPlayerIcon icon-play" data-mediathumb-url="src"></div>\n                <div id="sound_options" class="MediaPlayerIcon icon-volume">\n                    <input id="volume" class="MediaPlayerControl-volume" type="range" max="100" min="0" />\n                </div>\n            </div>\n            <input id="MediaPlayerControl-seekbar" type="range" name="rng" min="0" value="0">\n            <div id="time-position"></div>\n        </div>\n    </div>\n    ',replaceurl("player="+urlParameter);var t=new Audio;console.log(t);var a=document.getElementById("MediaPlayerControl-seekbar"),i=document.getElementById("album"),o=document.getElementById("MediaPlayerIcon-icon-play"),l=document.getElementById("MediaPlayerIcon-icon-play"),r=document.getElementById("time-position"),c=document.getElementById("sound_options"),d=document.getElementById("volume");function u(e){var n=Math.floor(e/60),t=Math.floor(e-60*n);return t<10&&(t="0"+t),n+":"+t}e.onchange=function(){var e=this.files;o.setAttribute("data-mediathumb-url",URL.createObjectURL(e[0]));var s=o.getAttribute("data-mediathumb-url");t.src=s,t.load();var m=e[0].name;n.textContent!="Unknown Artist - "+e[0].name&&(n.textContent="Unknown Artist - "+e[0].name),"url(../../images/default/default-album-icon.png)"!=i.style.backgroundImage&&(i.style.backgroundImage="url(../../images/default/default-album-icon.png)"),ID3.read(e[0],{onSuccess:function(e){console.log(e);const t=e.tags.picture.data,a=e.tags.picture.format,o=e.tags.title,l=e.tags.artist;if(0!=t.length&&null!=a){let e="";for(var r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);var c="data:"+a+";base64,"+window.btoa(e);i.style.backgroundImage="url("+c+")"}""!=o&&""!=l&&(n.textContent=l+" - "+o)},onError:function(e){console.log(e)}}),replaceurl("player=true&input="+m),t.play();var g=new AudioContext;console.log(g);var v=g.createMediaElementSource(t),y=g.createAnalyser(),h=0,f=document.getElementById("canvas"),p=f.getContext("2d");v.connect(y);var I=g.createGain();const M=f.width/2,w=f.height/2;y.connect(I),I.connect(g.destination);y.fftSize=512,y.maxDecibels=-3,y.minDecibels=-150;var b=y.frequencyBinCount;console.log(b),console.log(y);var P,E=new Uint8Array(b),C=new Uint8Array(512),B=(f.height,f.width),S=f.height,L=B/b;!function e(){requestAnimationFrame(e),y.getByteFrequencyData(E),y.getByteTimeDomainData(C);var n=u(t.currentTime),a=u(t.duration);r.innerHTML=n+" / "+a,h=getRMS(E),p.clearRect(0,0,B,S),p.fillStyle="#000000",p.fillRect(0,0,B,S);let i=h/7;I.gain.setValueAtTime(d.value/100,t.currentTime);for(var o=0;o<b;o++){P=E[o]/255*60,p.save(),p.translate(M,w),p.rotate(90+o*(2*Math.PI/b));var l=P/60*255+o/b*25,c=o/b*250;p.fillStyle="rgb("+l+","+c+",50)",p.fillRect(0,0+i,L,P),p.fillStyle="rgb(255,255,255)",p.fillRect(0,0+i+P,L,1),p.restore()}p.beginPath(),p.arc(M,w,i,0,2*Math.PI,!1),p.fillStyle="rgb("+calcRMSColor(h)+", "+calcRMSColor(h)+",0)",p.fill(),p.closePath()}(),t.play(),a.addEventListener("change",function(){t.currentTime=a.value}),c.addEventListener("click",function(){1==d.hidden?d.hidden=!1:d.hidden=!0}),t.addEventListener("timeupdate",function(){a.value=t.currentTime,a.max=t.duration}),l.addEventListener("click",function(){"MediaPlayerIcon icon-pause"==this.className?(this.className="MediaPlayerIcon icon-play",t.pause()):(this.className="MediaPlayerIcon icon-pause",t.play()),t.addEventListener("ended",function(){l.className="MediaPlayerIcon icon-play",a.value=a.max})}),t.addEventListener("pause",function(){l.className="MediaPlayerIcon icon-play"}),t.addEventListener("play",function(){l.className="MediaPlayerIcon icon-pause"})}});
